<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <base href="/">
    <title ng-bind="windowTitle"></title>

    <link rel="apple-touch-icon" sizes="180x180" href="/informer/images/favicon/apple-touch-icon.png?v=5">
    <link rel="icon" type="image/png" href="/informer/images/favicon/favicon-32x32.png?v=5" sizes="32x32">
    <link rel="icon" type="image/png" href="/informer/images/favicon/favicon-16x16.png?v=5" sizes="16x16">
    <link rel="manifest" href="/informer/images/favicon/manifest.json?v=5">
    <link rel="mask-icon" href="/informer/images/favicon/safari-pinned-tab.svg?v=5" color="#2196f3">
    <link rel="shortcut icon" href="/informer/images/favicon/favicon.ico?v=5">
    <meta name="msapplication-config" content="/informer/images/favicon/browserconfig.xml?v=5">
    <meta name="theme-color" content="#2196f3">

    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <meta property="fb:app_id" content="APP_ID">
    <meta property="og:title" content="">
    <meta property="og:type" content="website">
    <meta property="og:url" content="APP_URL">
    <meta property="og:image" content="APP_LOGO">
    <meta property="fb:admins" content="APP_ADMIN">

    <link href="https://fonts.googleapis.com/css?family=Lato|Roboto:400,400i,500,500i,700,700i,900,900i|Anonymous+Pro"
          rel="stylesheet" type="text/css">

    <!-- ui-libs-bower.min.css, priority: 50 -->

    <link rel="stylesheet" href="/informer/styles/ui-libs-bower.min.css">


    <!-- ui-styles.min.css, priority: 0 -->

    <link rel="stylesheet" href="/informer/styles/ui-styles.min.css">

    <style>
        .text-padding-top {
            padding-top: 25px;
        }

        .text-padding-left {
            padding-left: 10px;
        }

        .text-padding-right {
            padding-right: 10px;
        }

        .grid-container {
            height: 800px;
        }

        .full-size {
            height: 100%;
            width: 100%;
        }
    </style>
</head>
<body ng-cloak class="informer" ng-app="partner" layout="column">

<div ng-controller="PartnerReportCtrl as ctrl" flex layout="column">

    <!-- Dataset example -->
    <!--<md-content ng-if="ctrl.dataset" inf-dataset="::ctrl.dataset">-->

        <!--<div layout="row" class="side-padded">-->
            <!--<md-switch ng-model="ctrl.requireFilter" aria-label="Require filter?">-->
                <!--Require Filter-->
            <!--</md-switch>-->
            <!--<span flex></span>-->
            <!--<md-menu ng-if="(ctrl.requireFilter && ctrl.filter.bool.must.length) || !ctrl.requireFilter">-->
                <!--<md-button ng-click="$mdMenu.open($event)" class="md-raised">-->
                    <!--<md-icon>file_download</md-icon>-->
                    <!--Export-->
                <!--</md-button>-->
                <!--<md-menu-content width="5" class="md-dense">-->
                    <!--<md-menu-item ng-repeat="exporter in ctrl.exporters track by exporter.id">-->
                        <!--<md-button ng-click="ctrl.exportFile(exporter, $event)">-->
                            <!--<md-icon md-font-icon-->
                                     <!--class="{{ exporter.contentType | mimeType:'icon' }}"></md-icon>-->
                            <!--{{ ::exporter.contentType | mimeType:'label' }}-->
                        <!--</md-button>-->
                    <!--</md-menu-item>-->
                <!--</md-menu-content>-->
            <!--</md-menu>-->
            <!--<inf-hide-show-filter ng-model="ctrl.showFilter"-->
                                  <!--has-filter="ctrl.settings.chips.length > 0"-->
                                  <!--ng-if="ctrl.dataset"></inf-hide-show-filter>-->
        <!--</div>-->

        <!--<div layout="column">-->

            <!--<div layout="row" class="side-padded">-->
                <!--<div class="text-padding-top text-padding-left text-padding-right">Order date on or after:</div>-->
                <!--<md-input-container>-->
                    <!--<label>Select date</label>-->
                    <!--<md-datepicker ng-model="ctrl.chosenDate"></md-datepicker>-->
                <!--</md-input-container>-->

                <!--<div class="text-padding-top text-padding-left">OR</div>-->

                <!--<div class="text-padding-top text-padding-left text-padding-right">Country exactly matches:</div>-->
                <!--<md-input-container class="md-block">-->
                    <!--<label>Enter Country</label>-->
                    <!--<input ng-model="ctrl.chosenCountry">-->
                <!--</md-input-container>-->

            <!--</div>-->

            <!--<div inf-filters inf-filter-search ng-model="ctrl.settings.chips"-->
                 <!--query="ctrl.settings.filter" active-chip="ctrl.activeChip" junction="ctrl.settings.junction">-->
                <!--<div layout="column" flex inf-filter-chips-sidenav-open="filterSidenav">-->
                    <!--<inf-dataset-filter-frame dataset="::ctrl.dataset" show-filter="ctrl.showFilter">-->
                        <!--<md-content flex layout="column" class="inf-grid-frame grid-container"-->
                                    <!--ng-if="(ctrl.requireFilter && ctrl.filter.bool.must.length) || !ctrl.requireFilter">-->
                            <!--<inf-dataset-grid dataset="::ctrl.dataset" config="ctrl.config"-->
                                              <!--dataset-filter="ctrl.settings.filter"-->
                                              <!--class="full-size"-->
                                              <!--limit-fields="ctrl.limitFields"></inf-dataset-grid>-->
                        <!--</md-content>-->
                    <!--</inf-dataset-filter-frame>-->
                <!--</div>-->
            <!--</div>-->

        <!--</div>-->

    <!--</md-content>-->

    <!--Ad hoc report example-->

    <md-content ng-if="ctrl.query">

        <!-- Input parameters, if they exist -->
        <form name="runForm" flex novalidate inf-top-state-color layout="column" ng-submit="ctrl.executeQuery()"
              style="padding-bottom:8px;">
        <div class="side-padded" ng-if="ctrl.keys.length">
            <div class="padded" component="ctrl.query.inputs" ng-model="ctrl.params"></div>
        </div>

        <div layout="row" class="side-padded">
            <!-- button to run query; will be enabled if the run form is valid (not required inputs are not defined
                and the query isn't already running -->
            <md-button type="submit" ng-disabled="runForm.$invalid || ctrl.isRunning" class="md-raised">
                <md-icon>play_arrow</md-icon>
                    Run Query
            </md-button>
            <!-- Indeterminate progress indicator, displays while query is running -->
            <md-progress-circular md-diameter="25" style="margin-top:10px;"
                                  ng-show="ctrl.isRunning"></md-progress-circular>
        </div>
            </form>

        <div layout="column" class="top-padded">

            <!-- Dataset grid to display query results -->
            <div ng-if="ctrl.dataset" inf-dataset="ctrl.dataset">
                <div inf-filters inf-filter-search ng-model="ctrl.settings.chips"
                     query="ctrl.settings.filter" active-chip="ctrl.activeChip" junction="ctrl.settings.junction">
                    <div layout="column" flex inf-filter-chips-sidenav-open="filterSidenav">
                        <inf-dataset-filter-frame dataset="ctrl.dataset" show-filter="ctrl.showFilter">
                            <md-content flex layout="column" class="inf-grid-frame grid-container">
                                <inf-dataset-grid dataset="ctrl.dataset" config="ctrl.config"
                                                  dataset-filter="ctrl.settings.filter"
                                                  class="full-size"
                                                  limit-fields="ctrl.limitFields"></inf-dataset-grid>
                            </md-content>
                        </inf-dataset-filter-frame>
                    </div>
                </div>
            </div>

        </div>

    </md-content>

</div>

<script>
    __ngDependencies = ["uiGmapgoogle-maps"]
</script>

<!-- JQuery -->

<script type="text/javascript" src="/informer/jquery/jquery.min.js"></script>
<script type="text/javascript" src="/informer/jquery/jquery-ui.min.js"></script>
<script type="text/javascript" src="/informer/scripts/ui-libs-bower.min.js"></script>
<script type="text/javascript" src="/informer/scripts/vendor-scripts.min.js"></script>
<script type="text/javascript" src="/informer/scripts/user-scripts.min.js"></script>
<script type="text/javascript" src="/informer/scripts/highcharts-scripts.min.js"></script>
<script type="text/javascript" src="/informer/scripts/ui-scripts.min.js"></script>
<script type="text/javascript" src="/informer/scripts/ui-templates.min.js"></script>
<script type="text/javascript" src="/informer/api/v_ngv1.js"></script>
<script type="text/javascript" src="/informer/scripts/domains-scripts.min.js"></script>
<script type="text/javascript" src="/informer/scripts/domains-templates.min.js"></script>
<script type="text/javascript" src="/informer/scripts/flow-steps-scripts.min.js"></script>
<script type="text/javascript" src="/informer/scripts/flow-steps-templates.min.js"></script>
<script type="text/javascript" src="/informer/scripts/google-maps-scripts.min.js"></script>
<script type="text/javascript" src="/informer/scripts/google-maps-templates.min.js"></script>
<script type="text/javascript" src="/informer/assets/google-maps/config.js"></script>
<script type="text/javascript" src="/informer/scripts/mysql-query-criteria-scripts.min.js"></script>
<script type="text/javascript" src="/informer/scripts/output-scripts.min.js"></script>
<script type="text/javascript" src="/informer/scripts/output-templates.min.js"></script>
<script type="text/javascript" src="/informer/scripts/reports-scripts.min.js"></script>
<script type="text/javascript" src="/informer/scripts/reports-templates.min.js"></script>
<script type="text/javascript" src="/informer/scripts/smart-job-scripts.min.js"></script>
<script type="text/javascript" src="/informer/scripts/smart-job-templates.min.js"></script>
<script type="text/javascript" src="/informer/scripts/visuals-scripts.min.js"></script>
<script type="text/javascript" src="/informer/scripts/visuals-templates.min.js"></script>
<script type="text/javascript" src="/informer/scripts/geocodio-scripts.min.js"></script>
<script type="text/javascript" src="/informer/scripts/geocodio-templates.min.js"></script>


<script language="javascript">
    angular.module('partner', ['informer', 'ngMaterial'])
            .config(function ($mdThemingProvider) {
                $mdThemingProvider.theme('default')
                        .primaryPalette('blue', { default: '600' })
                        .warnPalette('red', { default: '400' })
                        .accentPalette('green', { default: '500' });
            })
            .controller('PartnerReportCtrl', function ($scope, api, $mdDialog, $q, $http) {
                var self = this;


                /**
                 * Dataset Example
                 */
//                /**
//                 * This is an injectable service we created on the Informer side.
//                 * It has various functions, but we're using it for its export function,
//                 * 'showExportDialog' (see exportFile function below).
//                 */
//                this.datasetService = datasetService;
//
//                //dataset id to load
//                var id = 'admin:northwind-orders';
//
//                //whether a filter is required before displaying dataset data
//                this.requireFilter = false;
//
//                //initialize the filter object
//                this.filter = {
//                    bool: {
//                        must: []
//                    }
//                };
//
//                this.showFilter = true;
//                this.settings = {};
//
//                //the fields to display in the dataset grid (field aliases)
//                this.limitFields = ['OrderDate', 'ShipAddress', 'ShipRegion', 'ShipCountry', 'FirstName', 'LastName', 'ProductName'];
//
//                /**
//                 * Example of constructing a config object to use with inf-dataset-grid, to affect display (default sorts, default page size, etc.)
//                 */
////                this.config =
////                {
////                    // formatting object keyed by field name - like position, hidden, pinned, css, alignment
////                    columns: {},
////                    // Sort object { firstName: 'asc' }
////                    sortBy: [{ShipCountry: 'desc'}],
////                    // Default page size
////                    pageSize: 25,
////                    // group by array of field names
////                    groups: ['LastName'],
////                    // aggregates array of field names (used if grouping)
////                    aggregates: ['max:OrderDate'],
////                    // Choose whether or not to show the subheader (field name)
////                    showSubheaders: false,
////                    // Show columns that have been hidden with a special greyed out background -- useful for query edit mode
////                    displayHiddenFields: false,
////                    //Show top-level aggregates when grid is ungrouped
////                    showOverallAggregates: true
////                };
//
//                    //load the dataset model (will load dataset metadata -- name, fields, settings, etc.)
//                api.link('inf:dataset').get({ id: id })
//                        .then(function (dataset) {
//                            self.dataset = dataset;
//                            //get an array of fields on the dataset
//                            self.fields = dataset.embedded('inf:field');
//                            //load the registered exporters in the system
//                            return api.link('inf:dataset-exporters').get({ id: dataset.id });
//                        })
//                        .then(function (exporters) {
//                            //example of filtering exporters -- in this example, we only want the option of the Excel and PDF exporters
//                            self.exporters = _.filter(exporters, function (exporter) {
//                                return exporter.id === 'xlsx' || exporter.id === 'pdf'
//                            });
//                        })
//                        .catch(function (err) {
//                            self.$log.error(['dataset', 'export'], 'Unable to find Dataset exporters', err);
//                        });
//
//                //the function that gets called when a user clicks an export menu item
//                this.exportFile = function (output, $event) {
//                    /**
//                     * This function displays a dialog to the end user with various options, depending on the exporter
//                     * dataset - the dataset being exported
//                     * exporter - the exporter being used
//                     * settings - Settings to pass up with the export.  Mainly useful for sending up currently applied filters
//                     * (so that they can be applied to the exported data, if desired), as well as grid settings (i.e grouping and aggregates).
//                     * label - The default filename to be used
//                     * $event - The associated browser $event
//                     */
//                    self.datasetService.showExportDialog({
//                        dataset: this.dataset,
//                        exporter: output,
//                        settings: self.filter.bool.must.length ? {
//                            filter: self.filter,
//                            grid: self.config
//                        } : { grid: self.config },
//                        label: this.dataset.name,
//                        $event: $event
//                    });
//                };
//
//                //if the chosen date a user selects changes, update the filter
//                $scope.$watch('ctrl.chosenDate', function (newVal, oldVal) {
//                    if (!newVal) self.filter.bool.must = [];
//                    if (newVal && !angular.equals(newVal, oldVal)) {
//                        self.chosenCountry = null;
//                        self.filter.bool.must = [{ range: { OrderDate: { gte: newVal } } }];
//                    }
//                });
//
//                //if the chosen country a user selects changes, update the filter
//                $scope.$watch('ctrl.chosenCountry', function (newVal, oldVal) {
//                    if (!newVal) self.filter.bool.must = [];
//                    if (newVal && !angular.equals(newVal, oldVal)) {
//                        self.chosenDate = null;
//                        self.filter.bool.must = [{ terms: { ShipCountry: [newVal] } }];
//                    }
//                });


                /**
                 * Ad-hoc Report example
                 *
                 * This logic is designed to make the user re-run the query each time they hit this page.  Technically, we could
                 * check if the query already has a dataset (the TTL for a query dataset is actually an hour) and load that up,
                 * but with this approach, the user will have fresh data whenever they hit the page.
                 */

                self.isRunning = false;
                self.id = 1164;
                self.limitFields = ['id', 'active', 'lastName', 'userName', 'firstName', 'createdDate', 'displayName', 'emailAddress'];

                //load the ad-hoc report we want to run
                api.link('inf:query').get({ id: self.id })
                        .then(function (query) {
                            self.query = query;
                            //get the inputs defined on the ad-hoc report
                            self.keys = _.pluck(_.get(query, 'inputs.multiInput.inputs', {}), 'name');
                        })
                        .catch(function (err) {
                            console.log(err);
                        });

                /*
                Function called when clicking the 'Run Query' button
                 */
                this.executeQuery = function () {
                    self.isRunning = true;
                    var name = _.get(self.query, 'name');
                    //get the params entered for the report inputs, and strip out invalid/unnecessary values
                    var params = _.omit(self.params, function (value) {
                        return value === undefined || value === null || value.length === 0;
                    });

                    //POST to our query run route, passing up any report inputs
                    $http.post('http://localhost:4000/informer/api/queries/'+self.id+'/_run', {params: params})
                            .then(function () {
                                //get the dataset created for this report run
                                return $http.get('http://localhost:4000/informer/api/queries/'+self.id+'/dataset');
                            })
                            .then(function (response) {
                                //get a handle on the looked-up dataset
                                self.dataset = response.data;
                            })
                            .finally(function () {
                                self.isRunning = false;
                            });
                };
            });

    angular.module('informer')
            .constant('embedded', true)
            .constant('apiRoot', '/informer/api/')
            .constant('version', '5.0.11')
            .constant('build', '')
            .constant('environment', 'production')
            .constant('docRoot', '')
            .constant('serverTimezone', 'America/New_York')
            .constant('buildDate', new Date('2018-03-12T18:41:59.855Z'))
            .run(function (licenseService) {
                licenseService.setLicense({ enterprise: true });
            });
</script>

</body>
</html>